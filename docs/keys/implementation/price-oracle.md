# {{price_oracle_1}}
{{for_futarchy_to_work_you_need_a_way_of_extracting_the_price_of_a_proposals_conditional_market}}

{{the_naive_approach_is_to_just_use_the_spot_price_at_the_time_of_proposal_finalization_but_this_is_highly_manipulable_for_example_someone_could_pump_the_price_of_the_pass_market_right_before_finalization_in_order_to_force_the_proposal_to_pass}}

<figure><img src="../.gitbook/assets/conditional-markets-dark.png" alt=""><figcaption><p>{{Someone_could_bid_up}}</p></figcaption></figure>

### {{twap}}
{{less_naive_is_to_use_a_timeweighted_average_price_twap_twaps_are_much_harder_to_manipulate_for_example_if_tokens_pass_price_is_100_for_the_first_72_hours_of_a_proposal_and_then_a_manipulator_pushes_the_price_to_1000_for_the_last_15_minutes_the_twap_would_be_10311_only_a_3_difference_from_the_true_price}}

{{however_twaps_also_have_their_flaws_importantly_solana_validators_can_manipulate_twaps_by_setting_the_price_extremely_high_for_a_few_slots_because_the_validator_controls_the_slot_they_know_that_noone_would_be_able_to_sell_into_their_extremely_high_price_if_a_validator_controls_1_of_slots_they_could_force_a_proposal_through_by_100xing_the_pass_price_during_their_slots}}

### {{lagging_price_twap}}
{{we_deal_with_this_by_using_a_special_form_of_twap_we_call_a_lagging_price_twap_in_a_lagging_price_twap_the_number_that_gets_fed_into_the_twap_isnt_the_raw_price__its_a_number_that_tries_to_approximate_the_price_but_which_can_only_move_a_certain_amount_per_update_we_call_this_an__observation__each_dao_must_configure_the__first_observation__and__max_observation_change_per_update__that_get_used_in_its_proposals_markets}}

<figure><img src="../.gitbook/assets/twap-chart.png" alt=""><figcaption></figcaption></figure>

{{to_take_an_example_imagine_that_metadaos_first_observation_is_set_to_500_and_its_max_change_per_update_is_5_if_a_proposal_opens_with_a_pass_market_of_550_it_will_take_10_updates_before_the_observation_accurately_reflects_the_price_assuming_each_update_is_spaced_evenly_and_the_price_stays_at_550_the_twap_after_10_updates_will_be_5275_505__510__515__520__525__530__535__540__545__550__10_after_10_more_updates_it_will_be_53875}}

### {{one_minute_between_updates}}
{{ideally_the_twap_would_be_highly_sensitive_to_normal_price_movements_and_highly_insensitive_to_manipulated_price_movements_we_originally_allowed_one_update_per_slot_but_this_gives_the_opposite_effect_an_attacker_may_be_able_to_land_in_every_slot_whereas_normal_trading_activity_isnt_as_frequent_yet_so_an_attacker_would_move_the_price_more_than_genuine_price_movements_to_deal_with_this_we_only_allow_one_update_per_minute}}
