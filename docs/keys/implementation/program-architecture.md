# {{program_architecture_1}}
{{we_implement_futarchy_via_three_programs}}

{{conditional_vault_what_allows_the_creation_of_conditional_tokens}}
{{amm_allows_the_creation_of_ammbased_conditional_markets_provides_a_timeweighted_average_price_oracle}}
{{autocrat_the_program_that_coordinates_futarchy_allows_the_creation_of_daos_and_proposals_and_allows_proposals_to_be_finalized_based_on_the_prices_in_the_conditional_markets}}

### {{conditional_vault_program}} <a href="#conditional-vault-program" id="conditional-vault-program"></a>
{{for_a_decision_market_to_work_you_must_revert_all_of_the_markets_trades_when_the_condition_isnt_met_this_is_what_allows_speculators_to_place_trades_like_i_would_pay_5000_for_10_meta_if_this_proposal_passes}}

{{blockchains_like_solana_dont_allow_you_to_revert_transactions_after_theyve_been_finalized_so_we_need_a_mechanism_to__simulate__reverting_transactions_that_mechanism_is_conditional_tokens}}

{{conditional_tokens_are_tied_to__conditional_vaults__each_conditional_vault_has_a_specific__underlying_token_settlement_authority__and__proposal__in_the_case_of_futarchy_the_underlying_token_would_be_either_usdc_or_the_daos_token_the_settlement_authority_would_be_the_daos_treasury_and_the_proposal_would_be_a_proposal_to_the_dao}}

<figure><img src="../.gitbook/assets/conditional-vaults.png" alt="{{Conditional_Vault_Program}}" width="563"><figcaption></figcaption></figure>

{{once_a_vault_is_created_anyone_can_deposit_underlying_tokens_in_exchange_for_conditional_tokens_you_receive_two_types_of_conditional_tokens_ones_that_are_redeemable_for_underlying_tokens_if_the_vault_is_finalized_and_ones_that_are_redeemable_for_underlying_tokens_if_the_vault_is_reverted_for_example_if_you_deposit_10_usdc_into_a_vault_you_will_receive_10_conditionalonfinalize_usdc_and_10_conditionalonrevert_usdc}}

<figure><img src="../.gitbook/assets/conditional-vault-quote.png" alt="{{Conditional_Vault_Quote}}" width="563"><figcaption></figcaption></figure>

{{the_settlement_authority_can_either__finalize__or__revert__a_vault}}

{{if_the_settlement_authority_finalizes_a_vault_users_can_redeem_their_conditionalonfinalize_tokens_for_underlying_tokens_conversely_if_the_settlement_authority_reverts_a_vault_users_can_redeem_their_conditionalonrevert_tokens_for_underlying_tokens}}

<figure><img src="../.gitbook/assets/settled-market-conditional-vault.png" alt="{{Conditional_Vault_Settlement}}" width="563"><figcaption></figcaption></figure>

{{there_are_two_vaults_for_each_proposal_a_base_vault_and_a_quote_vault_the_base_vault_uses_the_daos_token_as_the_underlying_token_and_the_quote_vault_uses_usdc_as_the_underlying_token_for_example_metadao_proposals_have_vaults_for_meta_and_usdc}}

{{if_the_proposal_passes_both_vaults_are_finalized_if_it_fails_both_are_reverted}}

<figure><img src="../.gitbook/assets/conditional-vault-underlying.png" alt="{{Conditional_Vault_Asset}}" width="563"><figcaption></figcaption></figure>

{{this_allows_us_to_achieve_the_desired_reverting_of_trades_for_example_if_someone_mints_conditionalonpass_meta_and_trades_it_for_conditionalonpass_usdc_either_the_proposal_will_pass_and_they_can_redeem_conditionalonpass_usdc_for_usdc_or_the_proposal_will_fail_and_they_can_redeem_their_conditionalonfail_meta_for_their_original_meta}}

{{so_we_create_two_markets_per_proposal_one_where_conditionalonpass_meta_is_traded_for_conditionalonpass_usdc_and_one_where_conditionalonfail_meta_is_traded_for_conditionalonfail_usdc_this_allows_traders_to_express_opinions_like_this_token_would_be_worth_112_if_the_proposal_passes_but_its_only_worth_105_if_the_proposal_fails}}

<figure><img src="../.gitbook/assets/conditional-markets-interaction.png" alt="{{Layout_Of_Conditional}}" width="475"><figcaption></figcaption></figure>

### {{amm}} <a href='#amm' id='amm'></a>
{{decision_markets_are_facilitated_through_a_constantproduct_ammx20}}

{{Uniswap_amm}}

### {{autocrat}}  <a href='#autocrat' id='autocrat'></a>
{{the_last_piece_of_the_puzzle_is__autocrat__the_program_that_orchestrates_futarchy}}

{{anyone_can_interact_with_autocrat_to_create_a__proposal__which_contains_fields_such_as_a_proposal_number_proposal_description_link_and_an_executable_solana_virtual_machine_svm_instruction_for_example_someone_could_create_a_proposal_to_transfer_150000_usdc_to_a_development_team_to_improve_a_product_thats_managed_by_a_dao}}

{{the_requisite_conditional_vaults_and_markets_are_created_at_the_same_time}}

<figure><img src="../.gitbook/assets/autocrat-markets.png" alt="{{The_Program_Structure_For_Autocrat}}" width="563"><figcaption></figcaption></figure>

{{after_a_configurable_amount_of_time_3_days_by_default_anyone_can_trigger_proposal_finalization_in_finalization_autocrat_checks_if_the_twap_of_the_pass_market_is_x_higher_than_the_twap_of_the_fail_market_where_x_is_a_daoconfigured_threshold}}

{{x20if_it_is_it_finalizes_the_pass_market_reverts_the_fail_market_and_allows_the_svm_instruction_to_be_executed_if_it_isnt_it_reverts_the_pass_market_finalizes_the_fail_market_and_does_not_allow_the_svm_instruction_to_be_executed}}
